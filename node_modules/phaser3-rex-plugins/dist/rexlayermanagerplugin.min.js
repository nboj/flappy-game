!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexlayermanagerplugin=e()}(void 0,function(){function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(i);if(r){var n=o(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return s(this,t)}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}var e={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},a={hasProperty:function(t){var e=this.gameObject;return!!e.hasOwnProperty(t)||void 0!==e[t]},getProperty:function(t){return this.gameObject[t]},setProperty:function(t,e){return this.gameObject[t]=e,this},easeProperty:function(t,e,n,i,r,o,s){var a=this.tweens,h=a[t];h&&h.remove();var u=this.gameObject,c={targets:u,duration:n,ease:i,repeat:r,yoyo:o,onComplete:function(){a[t].remove(),a[t]=null,s&&s(u,t)},onCompleteScope:this};return c[t]=e,(h=this.scene.tweens.add(c)).timeScale=this.timeScale,a[t]=h,this}},f={hasMethod:function(t){return"function"==typeof this.gameObject[t]},call:function(t){if(!this.hasMethod(t))return this;for(var e=this.gameObject,n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e[t].apply(e,i),this}},d=function(){function i(t,e,n){h(this,i),this.GOManager=t,this.tweens={},this.setGO(e,n)}return t(i,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0}},{key:"freeTweens",value:function(){var t,e=this.tweens;for(var n in e)(t=e[n])&&t.remove(),e[n]=null;return this}},{key:"freeGO",value:function(){return this.freeTweens(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return t.setName(e),this.gameObject=t,this.name=e,this.freeTweens(),this}},{key:"setTimeScale",value:function(t){var e=this.tweens;for(var n in e){var i=e[n];i&&(i.timeScale=t)}return this}}]),i}();Object.assign(d.prototype,a,f,{hasData:function(t){var e=this.gameObject;return!!e.data&&e.data.has(t)},getData:function(t){return this.gameObject.getData(t)},setData:function(t,e){return this.gameObject.setData(t,e),this}});function l(t){return t>>16&255}function v(t){return t>>8&255}function y(t){return 255&t}function p(t,e,n,i){return void 0===i?i={}:!0===i&&(i=P),i.x=n.x+n.width*t,i.y=n.y+n.height*e,i}function m(t,e,n,i,r){if(t.hasOwnProperty("vp"))return t;void 0===n&&(n=.5),void 0===i&&(i=.5),void 0===r&&(r=p),function(e){if(e.events)return;var n=new E,i=e.x;Object.defineProperty(e,"x",{get:function(){return i},set:function(t){i!==t&&(i=t,n.emit("update",e))}});var r=e.y;Object.defineProperty(e,"y",{get:function(){return r},set:function(t){r!==t&&(r=t,n.emit("update",e))}});var o=e.width;Object.defineProperty(e,"width",{get:function(){return o},set:function(t){o!==t&&(o=t,n.emit("update",e))}});var s=e.height;Object.defineProperty(e,"height",{get:function(){return s},set:function(t){s!==t&&(s=t,n.emit("update",e))}}),e.events=n}(e);var o=e.events;function s(){r(n,i,e,t)}t.vp=e,o.on("update",s),t.once("destroy",function(){o.off("update",s),t.vp=void 0}),Object.defineProperty(t,"vpx",{get:function(){return n},set:function(t){n!==t&&(n=t,s())}}),Object.defineProperty(t,"vpy",{get:function(){return i},set:function(t){i!==t&&(i=t,s())}}),s()}function g(t){return void 0!==t.displayWidth?t.displayWidth:t.width}function b(t){return void 0!==t.displayHeight?t.displayHeight:t.height}var O={tint:0,alpha:1},w={setGOFadeMode:function(t){return"string"==typeof t&&(t=O[t]),this.fadeMode=t,this},setGOFadeTime:function(t){return this.fadeTime=t,this},hasTintFadeEffect:function(t){return(void 0===this.fadeMode||0===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setTint},hasAlphaFadeEffect:function(t){return(void 0===this.fadeMode||1===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setAlpha},fadeBob:function(t,e,n,i){var r=t.gameObject;return this.hasTintFadeEffect(r)?(void 0!==e&&t.setProperty("tintGray",255*e),t.easeProperty("tintGray",Math.floor(255*n),this.fadeTime,"Linear",0,!1,i)):this.hasAlphaFadeEffect(r)?(void 0!==e&&t.setProperty("alpha",e),t.easeProperty("alpha",n,this.fadeTime,"Linear",0,!1,i)):i&&i(r),this}},E=Phaser.Events.EventEmitter,P={},j=Phaser.Utils.Array.Remove,G={has:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){var e=this.get(t);return e?e.gameObject:null},addGO:function(t,e){this.remove(t,!0),this.hasTintFadeEffect(e)&&function(e,n){if(e.hasOwnProperty("tintR"))return;void 0===n&&(n=16777215);var i=l(n),r=v(n),o=y(n);Object.defineProperty(e,"tint",{get:function(){return n},set:function(t){t=16777215&Math.floor(t),e.setTint&&e.setTint(t),n!==t&&(i=l(n=t),r=v(n),o=y(n))}}),Object.defineProperty(e,"tintR",{get:function(){return i},set:function(t){t=255&Math.floor(t),i!==t&&(i=t,e.tint=(255&t)<<16|65535&n)}}),Object.defineProperty(e,"tintG",{get:function(){return r},set:function(t){t=255&Math.floor(t),r!==t&&(r=t,e.tint=(255&t)<<8|16711935&n)}}),Object.defineProperty(e,"tintB",{get:function(){return o},set:function(t){t=255&Math.floor(t),o!==t&&(o=t,e.tint=255&t|16776960&n)}}),Object.defineProperty(e,"tintGray",{get:function(){return Math.floor((i+r+o)/3)},set:function(t){t=255&Math.floor(t),i===t&&r===t&&o===t||(o=r=i=t,e.tint=(255&t)<<16|(255&t)<<8|255&t)}}),e.tint=n}(e),this.viewportCoordinateEnable&&m(e,this.viewport),e.once("destroy",function(){j(this.removedGOs,e),this.isEmpty&&this.emit("empty")},this);var n=new this.BobClass(this,e,t);return this.bobs[t]=n,this},add:function(t){for(var e=this.createGameObjectCallback,n=this.createGameObjectScope,i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=e.call.apply(e,[n,this.scene].concat(r));this.addGO(t,s);var a=this.get(t);return this.fadeBob(a,0,1),this},forEachGO:function(t,e){for(var n in this.bobs){var i=this.bobs[n].gameObject;if(e?t.call(e,i,n,this):t(i,n,this))break}return this}},_={remove:function(t,e){if(!this.has(t))return this;var n=this.get(t);return delete this.bobs[t],this.removedGOs.push(n.gameObject),e?n.destroy():this.fadeBob(n,void 0,0,function(){n.destroy()}),this},removeAll:function(){var t=this.bobs;for(var e in t)this.remove(e);return this},clear:function(t){void 0===t&&(t=!0);var e=this.bobs;for(var n in e)t&&e[n].destroy(),delete e[n];return this.removedGOs.length=0,this}},T={hasProperty:function(t,e){return!!this.has(t)&&this.get(t).hasProperty(e)},getProperty:function(t,e){if(this.has(t))return this.get(t).getProperty(e)},isNumberProperty:function(t,e){return"number"==typeof this.getProperty(t,e)},setProperty:function(t,e,n){return this.has(t)&&(this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).setProperty(e,n)),this},easeProperty:function(t,e,n,i,r,o,s,a){return this.has(t)&&(void 0===i&&(i=1e3),void 0===r&&(r="Linear"),void 0===o&&(o=0),void 0===s&&(s=!1),this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).easeProperty(e,n,i,r,o,s,a)),this},hasTweenTask:function(t,e){return!!this.has(t)&&this.get(t).tweens.hasOwnProperty(e)},getTweenTask:function(t,e){if(!this.has(t))return null;var n=this.get(t).tweens[e];return n||null}},k={hasMethod:function(t,e){return!!this.has(t)&&this.get(t).hasMethod(e)},call:function(t,e){var n;if(!this.has(t))return this;for(var i=arguments.length,r=new Array(2<i?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return(n=this.get(t)).call.apply(n,[e].concat(r)),this}},C={hasData:function(t,e){return!!this.has(t)&&this.get(t).hasData(e)},getData:function(t,e){if(this.has(t))return this.get(t).getData(e)},setData:function(t,e,n){return this.has(t)&&this.get(t).setData(e,n),this}};Phaser.Geom.Rectangle;function x(t,e,n){var i,r,o,s,a,h,u,c,f,d,l,v,y,p;(t.getBounds||void 0!==t.width&&void 0!==t.height)&&("number"==typeof n?i=n:(i=L(n,"color"),r=L(n,"lineWidth")),void 0===i&&(i=16777215),void 0===r&&(r=1),D[0]=(o=t,void 0===(s=D[0])?s=new S:!0===s&&(void 0===B&&(B=new S),s=B),o.getTopLeft?o.getTopLeft(s):(s.x=o.x-g(o)*o.originX,s.y=o.y-b(o)*o.originY,R(o,s,a))),D[1]=(h=t,void 0===(u=D[1])?u=new S:!0===u&&(void 0===B&&(B=new S),u=B),h.getTopRight?h.getTopRight(u):(u.x=h.x-g(h)*h.originX+g(h),u.y=h.y-b(h)*h.originY,R(h,u,c))),D[2]=(f=t,void 0===(d=D[2])?d=new S:!0===d&&(void 0===B&&(B=new S),d=B),f.getBottomRight?f.getBottomRight(d):(d.x=f.x-g(f)*f.originX+g(f),d.y=f.y-b(f)*f.originY+b(f),R(f,d,l))),D[3]=(v=t,void 0===(y=D[3])?y=new S:!0===y&&(void 0===B&&(B=new S),y=B),v.getBottomLeft?v.getBottomLeft(y):(y.x=v.x-g(v)*v.originX,y.y=v.y-b(v)*v.originY+b(v),R(v,y,p))),e.lineStyle(r,i).strokePoints(D,!0,!0))}var S=Phaser.Math.Vector2,M=Phaser.Math.RotateAround,B=void 0,R=function(t,e,n){void 0===n&&(n=!1),0!==t.rotation&&M(e,t.x,t.y,t.rotation),n&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},L=Phaser.Utils.Objects.GetValue,D=[void 0,void 0,void 0,void 0],A={drawGameObjectsBounds:function(e,n){return this.forEachGO(function(t){t.drawBounds?t.drawBounds(e,n):x(t,e,n)}),this}};Object.assign(A,w,G,_,T,k,C);function F(t,e,n){e instanceof V||(n=e,e=void 0),void 0===n?n=new X:!0===n&&(n=Y);var i,r,o=t.sys.scale,s=o.baseSize,a=o.parentSize,h=o.canvasBounds,u=o.displayScale,c=0<=h.x?0:-(h.x*u.x),f=0<=h.y?0:-(h.y*u.y);return i=a.width>=h.width?s.width:s.width-(h.width-a.width)*u.x,r=a.height>=h.height?s.height:s.height-(h.height-a.height)*u.y,n.setTo(c,f,i,r),e&&(n.width/=e.zoomX,n.height/=e.zoomY,n.centerX=e.centerX+e.scrollX,n.centerY=e.centerY+e.scrollY),n}var V=Phaser.Cameras.Scene2D.BaseCamera,X=Phaser.Geom.Rectangle,Y=new X,N=Phaser.Utils.Objects.GetValue,z=function(){function r(t,e){h(this,r),this.scene=t,this.BobClass=N(e,"BobClass",d),this.setCreateGameObjectCallback(N(e,"createGameObject"),N(e,"createGameObjectScope")),this.setEventEmitter(N(e,"eventEmitter",void 0));var n=N(e,"fade",500);"number"==typeof n?(this.setGOFadeMode(),this.setGOFadeTime(n)):(this.setGOFadeMode(N(n,"mode")),this.setGOFadeTime(N(n,"time",500)));var i=N(e,"viewportCoordinate",!1);!1!==i?(this.setViewportCoordinateEnable(N(e,"enable",!0)),this.setViewport(N(i,"viewport"))):this.setViewportCoordinateEnable(!1),this.setSymbols(N(e,"symbols")),this.bobs={},this.removedGOs=[],this._timeScale=1}return t(r,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.viewport=void 0,this.scene=void 0}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e=this.bobs;for(var n in e)e[n].setTimeScale(t)}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t,e){return this.createGameObjectCallback=t,this.createGameObjectScope=e,this}},{key:"setViewportCoordinateEnable",value:function(t){return void 0===t&&(t=!0),this.viewportCoordinateEnable=t,this}},{key:"setViewport",value:function(t){return void 0===t&&(t=F(this.scene,this.scene.cameras.main)),this.viewport=t,this}},{key:"setSymbols",value:function(t){return this.symbols=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return!1;return!0}(this.bobs)&&0===this.removedGOs.length}}]),r}();Object.assign(z.prototype,e,A);var I=Phaser.Utils.Objects.GetValue,U=function(){r(a,z);var s=u(a);function a(t,e){var n;h(this,a),void 0===e?e={}:Array.isArray(e)&&(e={layers:e}),e.hasOwnProperty("fade")||(e.fade=0),e.viewportCoordinate=!1,n=s.call(this,t,e);var i=I(e,"layers");if(i)for(var r=0,o=i.length;r<o;r++)n.add(i[r]);return n}return t(a,[{key:"setCreateGameObjectCallback",value:function(t,e){return t=t||W,c(o(a.prototype),"setCreateGameObjectCallback",this).call(this,t,e),this}},{key:"addGO",value:function(t,e){return c(o(a.prototype),"addGO",this).call(this,t,e),e.name=t,this}},{key:"getLayer",value:function(t){return this.getGO(t)}},{key:"getLayers",value:function(e){return void 0===e&&(e=[]),this.forEachGO(function(t){e.push(t)}),function(t,e){if(0===t.length)return;void 0===e&&(e=!1);var n=t[0].scene.sys.displayList;n.depthSort(),e?t.sort(function(t,e){return n.getIndex(e)-n.getIndex(t)}):t.sort(function(t,e){return n.getIndex(t)-n.getIndex(e)})}(e,!1),e}},{key:"addToLayer",value:function(t,e){var n=this.getGO(t);if(n)return e.isRexContainerLite?e.addToLayer(n):n.add(e),this;console.warn("Can't get layer \"".concat(t,'"'))}}]),a}(),W=function(t,e){var n=t.add.layer();return void 0!==e&&n.setDepth(e),n};return function(){r(n,Phaser.Plugins.BasePlugin);var e=u(n);function n(t){return h(this,n),e.call(this,t)}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new U(t,e)}}]),n}()});
